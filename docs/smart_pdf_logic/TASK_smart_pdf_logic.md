# 任务拆解：智能 PDF 提取

## 任务 1：字体和布局分析的实用函数
- **目标**: 实现确定主导字体大小和页面边距的函数。
- **输入**: `fitz.Page`
- **输出**: `body_font_size`, `body_indent_x`。
- **步骤**:
    1.  使用 `page.get_text("dict")` 提取所有块。
    2.  构建字体大小直方图。
    3.  识别众数（最频繁）作为正文字体。
    4.  识别正文文本块的最小 x0 作为基准缩进。

## 任务 2：块处理逻辑
- **目标**: 遍历块并分类行。
- **输入**: Blocks, Body Metrics。
- **输出**: 带有元数据（is_header, is_list 等）的处理后文本段列表。
- **逻辑**:
    - 对于每一行：
        - 检查相对于基准缩进的缩进。
        - 检查相对于正文字体的字体大小。
        - 确定是否为 "短行" (x1 < Page Width - Margin)。

## 任务 3：Markdown 格式化与合并
- **目标**: 将处理后的片段重新组装成 Markdown 字符串。
- **逻辑**:
    - **标题**: 根据大小添加 `## ` 或 `### ` 前缀。
    - **列表项**: 如果缩进，添加 `- ` 前缀。
    - **合并**:
        - 如果上一行是 "短行" -> 插入 `\n`。
        - 如果上一行是 "满行" -> 插入 ` ` (空格)。
    - **清理**: 处理特殊字符。

## 任务 4：集成到 `server.py`
- **目标**: 替换当前的 `extract_content` 逻辑。
- **步骤**:
    1.  添加新的辅助函数到 `server.py`。
    2.  修改 `extract_content` 以在适当时调用 `extract_smart_text` (或总是)。
    3.  确保向后兼容性（返回 `TextContent` 列表）。

## 任务 5：验证
- **目标**: 确保代码无语法错误并产生合理的输出。
- **方法**: 运行 `server.py` (如果可能) 或创建一个小的测试脚本。
