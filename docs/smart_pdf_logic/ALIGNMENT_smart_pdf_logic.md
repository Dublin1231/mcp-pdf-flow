# 对齐文档：智能 PDF 提取逻辑

## 1. 项目背景
当前的 `simple-pdf-extractor` 使用 `page.get_text()` 提供基本的文本提取功能。用户需要一种“智能提取”机制，能够区分：
- **标题/头**: 基于字体大小。
- **段落**: 在尊重句子边界的同时合并属于同一段落的行。
- **列表项**: 特别处理缩进的项目（例如 "JDBC..." 描述），这些项目可能有也可能没有项目符号。

## 2. 问题陈述 (用户反馈)
用户发现了列表项被错误地合并到前一段落或未被识别为不同块的问题。
具体示例：
- "JDBC（Java DataBase Connectivity）..." 应被视为列表项。
- 缩进是一个关键的区别因素（例如，标题 x=75.5 vs 列表项 x=98.0）。
- 有些列表项是单句，有些较长。
- 如果列表项代表一个新的点，则不应将其合并到上一个文本块中。

## 3. 目标
1.  **增强 `server.py`**: 用块级分析 (`page.get_text("dict")` 或 `"blocks"`) 替换基本提取。
2.  **实现启发式算法**:
    - **标题检测**: 检测字体大小变化。
    - **列表项检测**: 检测显著的缩进变化。
    - **智能合并**: 仅在看起来是连续文本时合并行（检查行宽和字体一致性）。
3.  **输出格式**: 生成 Markdown 友好的输出（使用 `#` 表示标题，`-` 表示列表）。

## 4. 关键决策
- **提取方法**: 使用 `page.get_text("dict")` 访问字体大小和 bbox 信息。
- **字体分析**: 计算每页或文档的“最常见字体大小”（正文文本）。
- **列表检测逻辑**:
    - 如果 `indent > body_indent + threshold`: 视为列表项（或引用）。
    - 如果 `line_width < threshold` (提前结束): 视为段落结束（不与下一行合并）。
- **行宽检查**:
    - 如果一行在右边距之前显著结束（例如 `page_width - x1 > 50`），则可能是段落结束或列表项，因此插入换行符 `\n`。
    - 如果一行到达右边距，则可能是换行，因此用空格合并。

## 5. 风险与假设
- **风险**: 不同 PDF 中的缩进不一致。
- **缓解措施**: 如果可能，计算相对于*页面*正文文本的缩进，而不是绝对值。（目前，我们将使用动态检测“最左侧”文本作为基准）。
- **假设**: 用户的 PDF 遵循合理的标准布局（从左到右）。

## 6. 下一步
- 进入架构阶段设计 `TextAnalyzer` 类（或逻辑组件）。
